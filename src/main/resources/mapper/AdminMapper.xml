<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.team.teamreadioserver.user.admin.mapper.AdminMapper">

    <!-- 관리자 회원 목록 조회 -->
    <select id="selectAdminUserList" resultType="com.team.teamreadioserver.user.admin.dto.AdminUserViewDTO">
        SELECT
        u.user_id AS userId,
        u.user_name AS userName,
        u.user_email AS userEmail,
        u.user_phone AS userPhone,
        u.user_birthday AS userBirthday,
        u.user_role AS userRole,
        CASE u.user_role
        WHEN 'USER' THEN '일반회원'
        WHEN 'ADMIN' THEN '관리자'
        WHEN 'SUSPENDED' THEN '정지회원'
        ELSE '알수없음'
        END AS userRoleName, -- 여기서 한글 변환
        COALESCE(r.total_report_count, 0) AS reportCount,
        u.user_enrolldate AS userEnrollDate -- 가입일자

        FROM
        user u
        LEFT JOIN
        (
        SELECT report_id AS user_id, COUNT(*) AS total_report_count
        FROM (
        SELECT report_id FROM reported_post
        UNION ALL
        SELECT report_id FROM reported_review
        ) combined_reports
        GROUP BY report_id
        ) r
        ON u.user_id = r.user_id
        ORDER BY reportCount DESC
        <!--여기 수정해야됨~~~-->
    </select>
</mapper>